#!/usr/bin/python
# -*- coding: utf-8 -*-
#
# This file is part of my.gpodder.org.
#
# my.gpodder.org is free software: you can redistribute it and/or modify it
# under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or (at your
# option) any later version.
#
# my.gpodder.org is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public
# License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with my.gpodder.org. If not, see <http://www.gnu.org/licenses/>.
#

import os
import sys
import MySQLdb

# Make sure the local "mygpo" package is in our PATH
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from mygpo.settings import *

# All allowed procedure names should be listed here
VALID_PROCEDURES = ('update_suggestion', )

if len(sys.argv) != 2 or sys.argv[-1] not in VALID_PROCEDURES:
    print >>sys.stderr, """
    Usage: python %s [%s]
    """ % (sys.argv[0], '|'.join(VALID_PROCEDURES))
else:
    procedure_name = sys.argv[-1]
    try:
        connection = MySQLdb.connect(host=DATABASE_HOST, user=DATABASE_USER, \
                passwd=DATABASE_PASSWORD, db=DATABASE_NAME)

        cur = connection.cursor()
        cur.callproc(procedure_name, ())
        cur.close()

        connection.close()
    except MySQLdb.Error, e:
        print >>sys.stderr, 'MySQL Error %d:  %s' % (e.args[0], e.args[1])
        sys.exit(1)

