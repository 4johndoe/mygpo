{% extends "base.html" %}
{% load i18n %}
{% load humanize %}
{% load episodes %}
{% load podcasts %}
{% load devices %}
{% load charts %}

{% block title %}{{ podcast.title|default:"Unnamed Podcast"|striptags }}{% endblock %}

{% block content %}
  <div id="podcastlogo">{{ podcast|podcast_logo:"200" }}</div>

  <h1>{% if podcast.title %}{{ podcast.title|striptags }}{% else %}{% trans "Unnamed Podcast" %}{%endif%}</h1>
  <a href="{{ podcast.url }}" class="URL">{{ podcast.url }}</a>

  {% if podcast.description %}
   <p class="description">{{ podcast.description|striptags }}</p>
  {% endif %}

  {% if not user.is_authenticated %}
   <div class="subscribe">
    <a href="/podcast/{{ podcast.id }}/subscribe">
     {% if podcast.title %}
      {% blocktrans with podcast.title|striptags as podcasttitle %}Subscribe to {{ podcasttitle }}{% endblocktrans %}
     {% else %}
      {% trans "Subscribe to this podcast" %}
     {% endif %}
    </a>
   </div>	
  {% else %}

   {% if not devices|length_is:"0"  %}

    <h2>{% trans "Devices" %}</h2>
    <strong>{% trans "You have subscribed this podcast on" %}</strong>
    <ul class="devices">
     {% for device in devices %}
      <li class="{{device.type}}">
       <div class="devicesLeft"><a href="/device/{{ device.id }}">{{ device|striptags }}</a></div>
       <div class="devicesRight"><a href="/podcast/{{ podcast.id}}/unsubscribe/{{ device.id }}?return_to=/podcast/{{ podcast.id }}"><img src="/media/unsubscribe.png" /></a></div>
       <div class="devicesClear"></div>
      </li>
     {% endfor %}
    </ul>
 
   {% endif %}

   {% if can_subscribe %}
    <div class="subscribe">
     <a href="/podcast/{{ podcast.id }}/subscribe">
      {% if podcast.title %}
       {% blocktrans with podcast.title|striptags as podcasttitle %}Subscribe to {{ podcasttitle }}{% endblocktrans %}
      {% else %}
       {% trans "Subscribe to this podcast" %}
      {% endif %}
     </a>
    </div>
   {% endif %}


   {% if privacy_form %}
    <h2>{% trans "Privacy" %}</h2>
    {% if success %}
     <div class="success">{% trans "Your settings have been saved." %}</div>
    {% endif %}

    <form action="" method="POST">
     {{ privacy_form.as_p }}
     <input type="submit" value="Save" />
    </form>
   {% endif %}
  
  {% endif %} {% comment %} End of user-only content{% endcomment  %}


  {% if episodes %}
   <h2>{% trans "Episodes" %}</h2>
   <table class="list episode_list">
    <tr>
     <th></th>
     <th>{% trans "Episode" %}</th>
     <th>{% trans "Released" %}</th>
     <th>{% trans "Listeners" %}</th>
    </tr>
 
    {% for episode in episodes %}
     <tr>
      <td style="text-align: center; padding-left: 5px; padding-right: 5px;">{{ episode.action|episode_status_icon }}</td>
      <td>
          <p class="title"><a href="/episode/{{ episode.id }}">{{ episode.title|default:"Unknown Episode"|striptags }}</a></p>
          <p class="description">{{ episode.description|default:""|striptags|truncatewords:"15" }}</p>
      </td>
      <td>{{ episode.timestamp|default:""|date:"Y-m-d" }}</td>
      <td>
       {% if episode.listeners %}
        {{ episode.listeners|vertical_bar:max_listeners }}
       {% endif %}
      </td>
     </tr>
    {% endfor %}
   </table>
  {% endif %}

  {% if history %}
   <h2>{% trans "Subscription History" %}</h2>
   <table class="list">
    <tr>
     <th>{% trans "Timestamp" %}</th>
     <th>{% trans "Action" %}</th>
     <th>{% trans "Devices" %}</th>
    </tr>
    {% for s in history %}
     <tr>
      <td><abbr title="{{ s.timestamp }}">{{ s.timestamp|naturalday }}</abbr></td>
      <td>{{ s|podcast_status_icon }}</td>
      <td>
       <a href="/device/{{ s.device.id }}">{{ s.device|device_icon }} {{ s.device.name|striptags }}</a></td>
     </tr>
    {% endfor %}
   </table>
  {% endif %}

  {% if not podcast.title %}
   <div class="info"><strong>{% trans "Why Unnamed Podcast?" %}</strong> {% trans "Because we display names after we have fetched the information form the feed -- and this may take some time. Until this is completed, the podcast will simply be called this way." %}</div>
  {% endif %}

{% endblock %}

