{% extends "base.html" %}
{% load i18n %}
{% load humanize %}
{% load devices %}
{% load podcasts %}
{% load episodes %}

{% load menu %}
{% block mainmenu %}{{ "/history/"|main_menu }}{% endblock %}
{% block sectionmenu %}{{ "/history/"|section_menu }}{% endblock %}

{% block title %}{% trans "Subscription and episode history" %}{% if singledevice %} {% trans "for" %} {{ singledevice|striptags }}{% endif %}{% endblock %}

{% block content %}
<h1>{% trans "Subscription and episode history" %}{% if singledevice %} {% trans "for" %} {{ singledevice|striptags }}{% endif %}</h1>
<p>{% trans "This is a list of recent subscription and episode actions for your account." %}</p>

   {% if singledevice %}
    <a href="{% url device singledevice.id %}">{% trans "Back to" %} {{ singledevice|device_icon }} {{singledevice|striptags}}</a>
   {% endif %}

   {% if not generalhistory|length_is:"0" %}
   <table class="list">
    <tr>
     <th></th>
     <th>{% trans "Podcast/Episode" %}</th>
     <th style="text-align: center;">{% trans "Date" %}</th>
     <th style="text-align: center;">{% trans "Action" %}</th>
     <th>{% trans "Device" %}</th>
    </tr>
    {% for s in generalhistory %}
     <tr>
      {% if s.podcast %}
       <td>{{ s.podcast|podcast_logo }}</td>
      {% else %}
       <td>{{ s.episode.podcast|podcast_logo }}</td>
      {% endif %}

      <td>
       {% if s.podcast %}
        <a href="{% url podcast s.podcast.id %}">{{ s.podcast|striptags }}</a>
       {% else %}
        <a href="{% url episode s.episode.id %}">
         {% if s.episode.title %}
          {{ s.episode.title|striptags }}
         {% else %}
          {% trans "Unnamed Episode" %}
         {% endif %}
     </a><br/><span class="from_podcast">{% trans "from" %} <a href="{% url podcast s.episode.podcast.id %}">{{ s.episode.podcast|striptags }}</a></span>
       {% endif %}
      </td>
      <td style="width: 80px;"><span title="{{ s.timestamp }}">{{ s.timestamp|date:"Y-m-d" }}</span></td>
      <td style="text-align: center;">
       {% if s.podcast %}
        {{ s|podcast_status_icon }}
       {% else %}
        {{ s|episode_status_icon }}
       {% endif %}
      </td>
      <td><a href="{% url device s.device.id %}">{{ s.device|device_icon }}&nbsp;{{ s.device.name|striptags }}</a></td>
     </tr>
    {% endfor %}
   </table>
  {% endif %}


{% endblock %}
